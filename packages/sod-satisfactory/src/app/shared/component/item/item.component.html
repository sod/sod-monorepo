<app-dropdown [dropdown]="dropdown" [element]="element" (keyboard)="onKeyboard($event)" #dropdownController>
    <app-input [label]="labels[target]">
        <input
            #element
            appInputControl
            type="search"
            [ngModel]="itemPackage?.itemName ?? ''"
            (input)="itemSelected(element.value, itemPackage)"
            (focus)="needle.set(element.value)"
            (blur)="itemPackage?.itemName === '' && remove(itemPackage!)"
        />
    </app-input>
</app-dropdown>

<ng-template #dropdown>
    @if (suggestions$ | async; as suggestions) {
        @for (option of suggestions.items; track option) {
            <li (click)="itemSelected(option, itemPackage); dropdownController.close()">
                <span
                    class="dropdown-item"
                    [class.active]="option === selected()"
                    [class.text-decoration-underline]="$first && option?.toLowerCase() === itemPackage?.itemName?.toLowerCase()"
                >
                    {{ option }}
                </span>
            </li>
        }
        <li><h6 class="dropdown-header">Recipes</h6></li>
        @if (suggestions.recipes; as recipes) {
            @if (!recipes.length) {
                <li><span class="dropdown-item disabled">none</span></li>
            }
            @for (option of recipes; track option) {
                <li (click)="itemSelected(option, itemPackage); dropdownController.close()">
                    <span class="dropdown-item" [class.active]="option === selected()">
                        <div>{{ option.name }}</div>
                        <div class="row my-2">
                            <app-package-images class="col px-2" [items]="option.inputs"></app-package-images>
                            <app-package-images class="col px-2 justify-content-end d-flex" [items]="option.outputs"></app-package-images>
                        </div>
                    </span>
                </li>
            }
        }
    }
</ng-template>
